import{C as r}from"./index-DBrTCu79.js";let o=null;async function a(){const t=localStorage.getItem("token");if(!t)throw new Error("User not authenticated");const n=await fetch(`${r.BASE_URL}/notifications/keys`,{headers:{Authorization:`Bearer ${t}`}});if(!n.ok)throw new Error("Failed to fetch VAPID key");return(await n.json()).vapidPublicKey}function c(t){const n="=".repeat((4-t.length%4)%4),i=(t+n).replace(/-/g,"+").replace(/_/g,"/"),e=window.atob(i);return Uint8Array.from([...e].map(s=>s.charCodeAt(0)))}async function u(){if(!("serviceWorker"in navigator)||!("PushManager"in window)){console.warn("Push notification not supported");return}const t=await navigator.serviceWorker.ready;if(await Notification.requestPermission()!=="granted"){console.warn("Notification permission denied");return}const i=await a(),e=c(i);o=await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e}),await p(o)}async function p(t){const n=localStorage.getItem("token");if(!(await fetch(`${r.BASE_URL}/notifications/subscribe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)})).ok)throw new Error("Failed to send push subscription");console.log("Push subscription sent successfully")}async function l(){if(!("serviceWorker"in navigator)||!("PushManager"in window)){console.warn("Push notification not supported");return}const n=await(await navigator.serviceWorker.ready).pushManager.getSubscription();n&&(await n.unsubscribe(),await f(n),o=null)}async function f(t){const n=localStorage.getItem("token");if(!(await fetch(`${r.BASE_URL}/notifications/unsubscribe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)})).ok)throw new Error("Failed to send push unsubscription");console.log("Push unsubscription sent successfully")}async function d(){return!("serviceWorker"in navigator)||!("PushManager"in window)?!1:!!await(await navigator.serviceWorker.ready).pushManager.getSubscription()}async function w(){return await d()?(await l(),!1):(await u(),!0)}export{d as isPushNotificationEnabled,u as subscribePushNotification,w as togglePushNotification,l as unsubscribePushNotification};
